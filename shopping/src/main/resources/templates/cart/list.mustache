<div class="header-wrapper has-nav">
    <div class="container">
        {{> layout/header }}
        {{> layout/nav }}
    </div>
</div>

<main class="main-container">
    <h1 class="page-title">장바구니</h1>

    <!-- 테스트 폼들 (나중에 제거 가능) -->
    <div class="test-forms">
        <form action="/cart/create" method="post" style="display:inline-block; margin-right: 10px;">
            <button class="btn-test">장바구니 추가</button>
        </form>

        <form action="/cart/1/add" method="post" style="display:inline-block;">
            <input type="number" name="productId" placeholder="상품ID" style="width: 80px; padding: 8px;" required>
            <input type="number" name="quantity" placeholder="수량" value="1" style="width: 60px; padding: 8px;" required>
            <button type="submit" class="btn-test">아이템 추가</button>
        </form>
    </div>

    <div class="cart-layout">
        <!-- 왼쪽: 장바구니 상품 목록 -->
        <div class="cart-left">
            <div class="cart-header">
                <div class="tab active">
                    <span>KREAM 배송</span>
                    <span class="count">{{cartItems.size}}</span>
                </div>
            </div>

            <div class="select-all">
                <label class="checkbox-label">
                    <input type="checkbox" id="selectAll">
                    <span class="checkmark"></span>
                    <span>전체 선택</span>
                </label>
                <form action="/cart/{{cartId}}/delete-checked" method="post" style="display:inline;">
                    <button type="submit" class="delete-btn" onclick="return confirm('선택한 상품을 삭제하시겠습니까?')">선택 삭제</button>
                </form>
            </div>

            <!-- 상품 아이템 -->
            {{#cartItems}}
                <div class="cart-item">
                    <label class="checkbox-label">
                        <input type="checkbox" class="item-checkbox" {{#isChecked}}checked{{/isChecked}}
                               onchange="toggleCheck({{cartId}}, {{id}})">
                        <span class="checkmark"></span>
                    </label>

                    <div class="item-content">
                        <div class="item-image-wrapper">
                            <div class="item-image">
                                <span class="product-icon">📦</span>
                            </div>
                        </div>

                        <div class="item-details">
                            <div class="item-info">
                                <h3 class="item-brand">{{product}}</h3>
                                <p class="item-desc">상품 ID: {{product}}</p>
                                <div class="item-meta">
                                    <span class="item-quantity">수량: {{quantity}}개</span>
                                    <span class="badge-fast">빠른배송</span>
                                </div>
                            </div>

                            <div class="item-price">
                                <p class="price">260,000원</p>
                            </div>
                        </div>

                        <div class="item-actions">
                            <form action="/cart/{{cartId}}/{{id}}/delete" method="post">
                                <button type="submit" class="btn-delete" onclick="return confirm('이 상품을 삭제하시겠습니까?')">
                                    <span>✕</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            {{/cartItems}}

            {{^cartItems}}
                <div class="empty-cart">
                    <div class="empty-icon">🛒</div>
                    <p class="empty-text">장바구니가 비어있습니다</p>
                    <p class="empty-subtext">원하는 상품을 담아보세요!</p>
                </div>
            {{/cartItems}}
        </div>

        <!-- 오른쪽: 결제 정보 -->
        <div class="cart-right">
            <div class="payment-box">
                <h2 class="payment-title">주문 예상금액</h2>

                <div class="price-breakdown">
                    <div class="price-row">
                        <span class="label">총 상품금액</span>
                        <span class="value">260,000원</span>
                    </div>
                    <div class="price-row">
                        <span class="label">배송비</span>
                        <span class="value">5,000원</span>
                    </div>
                    <div class="price-row">
                        <span class="label">검수비</span>
                        <span class="value free">무료</span>
                    </div>
                </div>

                <div class="total-price">
                    <span class="label">총 결제금액</span>
                    <span class="amount">265,000원</span>
                </div>

                <button class="checkout-btn">주문하기</button>

                <div class="benefit-info">
                    <p class="benefit-item">💳 네이버페이 4% 적립</p>
                    <p class="benefit-item">💰 롯데카드 3% 즉시할인</p>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    function toggleCheck(cartId, itemId) {
        fetch(`/cart/${cartId}/${itemId}/update/check`, {
            method: 'POST'
        })
                .then(response => {
                    if (response.ok) {
                        console.log('체크 상태 변경 완료');
                    } else {
                        alert('오류가 발생했습니다.');
                        event.target.checked = !event.target.checked;
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('오류가 발생했습니다.');
                    event.target.checked = !event.target.checked;
                });
    }

    // 전체 선택/해제
    document.getElementById('selectAll')?.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.item-checkbox');
        checkboxes.forEach(checkbox => {
            if (checkbox.checked !== this.checked) {
                checkbox.checked = this.checked;
                checkbox.onchange();
            }
        });
    });
</script>

{{>layout/footer}}